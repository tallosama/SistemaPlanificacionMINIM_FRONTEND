<nb-card class="col-md-12 col-lg-12 col-xxxl-12">
  <nb-card-body>
    <nb-stepper #stepper orientation="horizontal">
      <nb-step [label]="labelOne">
        <ng-template #labelOne>Registro del evento</ng-template>
        <h3>Registro de eventos</h3>

        <nb-card-body>
          <form [formGroup]="eventoForm" *ngIf="eventoForm">
            <label class="label">Descripción</label>
            <div class="row">
              <div class="col-md-10">
                <textarea
                  rows="2"
                  formControlName="desEveto"
                  nbInput
                  fullWidth
                  shape="round"
                  placeholder="Descripción del evento"
                ></textarea>
              </div>
              <div class="col-md-2">
                <button nbButton [routerLink]="['../BuscarEventos']">
                  Buscar eventos
                </button>
              </div>
              <div
                *ngIf="
                  eventoForm.get('desEveto').invalid &&
                  eventoForm.get('desEveto').touched
                "
              >
                <p
                  class="caption status-danger"
                  *ngIf="
                    eventoForm.get('desEveto').hasError('required') ||
                    eventoForm.get('desEveto').hasError('incorrecto')
                  "
                >
                  La descripción es obligatoria
                </p>

                <p
                  class="caption status-danger"
                  *ngIf="eventoForm.get('desEveto').hasError('maxlength')"
                >
                  Debe de ingresar descripción menor o igual a 124 carácteres
                </p>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label class="label">Planificación</label>
                  <ng-autocomplete
                    [data]="planes"
                    [searchKeyword]="keyword[1]"
                    [itemTemplate]="itemTemplatePlan"
                    formControlName="planificacionId"
                    [notFoundTemplate]="notFoundTemplatePlan"
                    placeholder="Ingrese el plan"
                    [initialValue]="planes[0]"
                    notFoundText="No se encontró"
                    historyIdentifier="ListaPlanReciente"
                    [historyHeading]="historyHeading"
                    historyListMaxNumber="3"
                  >
                  </ng-autocomplete>

                  <ng-template #itemTemplatePlan let-plan>
                    <a [innerHTML]="plan.descripcion"></a>
                  </ng-template>

                  <ng-template #notFoundTemplatePlan let-notFoundPlan>
                    <div [innerHTML]="notFoundPlan"></div>
                  </ng-template>

                  <p
                    class="caption status-danger"
                    *ngIf="
                      eventoForm.get('planificacionId').hasError('required') ||
                      (eventoForm
                        .get('planificacionId')
                        .hasError('incorrecto') &&
                        eventoForm.get('planificacionId').touched)
                    "
                  >
                    La planificación es obligatoria
                  </p>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-group">
                  <label class="label">Área</label>

                  <ng-autocomplete
                    [data]="areas"
                    [searchKeyword]="keyword[0]"
                    formControlName="areaId"
                    [initialValue]="areas[0]"
                    [itemTemplate]="itemTemplateArea"
                    [notFoundTemplate]="notFoundTemplateArea"
                    placeholder="Ingrese el área"
                    notFoundText="No se encontró"
                    historyIdentifier="ListaAreaReciente"
                    [historyHeading]="historyHeading"
                    historyListMaxNumber="3"
                  >
                  </ng-autocomplete>
                  <ng-template #itemTemplateArea let-area>
                    <a [innerHTML]="area.desArea"></a>
                  </ng-template>
                  <ng-template #notFoundTemplateArea let-notFoundArea>
                    <div [innerHTML]="notFoundArea"></div>
                  </ng-template>
                  <p
                    class="caption status-danger"
                    *ngIf="
                      eventoForm.get('areaId').hasError('required') ||
                      (eventoForm.get('areaId').hasError('incorrecto') &&
                        eventoForm.get('areaId').touched)
                    "
                  >
                    El área es obligatorio
                  </p>
                </div>
              </div>
            </div>

            <!-- <div class="row">
            <div class="col-md-6">
              <div class="form-group"></div>
            </div>
          </div> -->

            <button
              nbButton
              [disabled]="eventoForm.invalid"
              (click)="guardarEvento()"
            >
              Guardar evento
            </button>
            <button
              nbButton
              nbStepperNext
              [disabled]="eventoForm.invalid"
              (click)="iniciarDetalle()"
            >
              Asignar detalles
            </button>
          </form>
        </nb-card-body>
        <!-- <button nbButton disabled nbStepperNext>prev</button>
        <button nbButton nbStepperNext>next</button> -->
      </nb-step>
      <nb-step [label]="labelTwo">
        <ng-template #labelTwo>Registro de detalles</ng-template>
        <h3>Registro de detalles</h3>

        <nb-card-body>
          <form [formGroup]="detalleEventoForm" *ngIf="detalleEventoForm">
            <div class="row">
              <!-- Hora -->

              <div class="form-group">
                <div class="col-md-2">
                  <label class="label">Hora</label>

                  <input
                    nbInput
                    type="text"
                    formControlName="hora"
                    [nbTimepicker]="timepickerHora"
                  />
                  <nb-timepicker
                    #timepickerHora
                    twelveHoursFormat
                  ></nb-timepicker>

                  <div
                    *ngIf="
                      detalleEventoForm.get('hora').invalid &&
                      detalleEventoForm.get('hora').touched
                    "
                  >
                    <p
                      class="caption status-danger"
                      *ngIf="detalleEventoForm.get('hora').hasError('required')"
                    >
                      La hora es requerida
                    </p>

                    <p
                      class="caption status-danger"
                      *ngIf="
                        detalleEventoForm.get('hora').hasError('maxlength')
                      "
                    >
                      Debe de ingresar hora menor o igual a 32 carácteres
                    </p>
                  </div>
                </div>
              </div>

              <!-- FECHA -->
              <div class="form-group">
                <div class="col-md-2">
                  <label class="label">Fecha</label>
                  <input
                    type="date"
                    nbInput
                    placeholder="Fecha del evento"
                    formControlName="fecha"
                  />
                  <!-- /PARA FORMATEAR FECHAS -->
                  <!-- <nb-datepicker
                    #formcontrol
                    format="MM\dd\yyyy"
                  ></nb-datepicker> -->

                  <p
                    class="caption status-danger"
                    *ngIf="
                      detalleEventoForm.get('fecha').hasError('required') &&
                      detalleEventoForm.get('fecha').touched
                    "
                  >
                    La fecha es requerida
                  </p>
                </div>
              </div>

              <!-- Municipio -->
              <div class="col-md-2">
                <div class="form-group">
                  <label class="label">Municipio</label>

                  <ng-autocomplete
                    [data]="municipios"
                    [searchKeyword]="keyword[2]"
                    formControlName="municipioId"
                    [initialValue]="municipios[0]"
                    [itemTemplate]="itemTemplateMun"
                    [notFoundTemplate]="notFoundTemplateMun"
                    placeholder="Ingrese el municipio"
                    notFoundText="No se encontró"
                    historyIdentifier="ListaMunReciente"
                    [historyHeading]="historyHeading"
                    historyListMaxNumber="3"
                  >
                  </ng-autocomplete>

                  <ng-template #itemTemplateMun let-mun>
                    <a [innerHTML]="mun.desMunicipio"></a>
                  </ng-template>

                  <ng-template #notFoundTemplateMun let-notFoundMun>
                    <div [innerHTML]="notFoundMun"></div>
                  </ng-template>
                  <p
                    class="caption status-danger"
                    *ngIf="
                      detalleEventoForm
                        .get('municipioId')
                        .hasError('required') ||
                      (detalleEventoForm
                        .get('municipioId')
                        .hasError('incorrecto') &&
                        detalleEventoForm.get('municipioId').touched)
                    "
                  >
                    El Municipio es obligatorio
                  </p>
                </div>
              </div>

              <!-- Participantes -->
              <div class="col-md-2">
                <div class="form-group">
                  <label class="label">Participantes</label>

                  <input
                    type="number"
                    formControlName="participantesProyectado"
                    nbInput
                    fullWidth
                  />
                  <p
                    class="caption status-danger"
                    *ngIf="
                      detalleEventoForm
                        .get('participantesProyectado')
                        .hasError('required') &&
                      detalleEventoForm.get('participantesProyectado').touched
                    "
                  >
                    La cantidad de participantes es requerida
                  </p>
                </div>
              </div>
              <!-- Estado -->
              <div class="col-md-2">
                <div class="form-group">
                  <label class="label">Estado</label>
                  <input
                    type="text"
                    formControlName="estado"
                    nbInput
                    fullWidth
                    [attr.disabled]="true"
                  />

                  <div
                    *ngIf="
                      detalleEventoForm.get('estado').invalid &&
                      detalleEventoForm.get('estado').touched
                    "
                  >
                    <p
                      class="caption status-danger"
                      *ngIf="
                        detalleEventoForm.get('estado').hasError('required')
                      "
                    >
                      El estado es requerido
                    </p>

                    <p
                      class="caption status-danger"
                      *ngIf="
                        detalleEventoForm.get('estado').hasError('maxlength')
                      "
                    >
                      Debe de ingresar un estado menor o igual a 32 carácteres
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <!-- Observacion -->
            <div class="row">
              <div class="col-md-12">
                <label class="label">Observación</label>
                <textarea
                  rows="5"
                  formControlName="observaciones"
                  nbInput
                  fullWidth
                  shape="round"
                  placeholder="Observación"
                ></textarea>
                <p
                  class="caption status-danger"
                  *ngIf="
                    detalleEventoForm
                      .get('observaciones')
                      .hasError('maxlength') &&
                    detalleEventoForm.get('observaciones').touched
                  "
                >
                  Debe de ingresar una Observación menor o igual a 512
                  carácteres
                </p>
              </div>
              <button
                nbButton
                (click)="agregarTabla()"
                [disabled]="detalleEventoForm.invalid"
              >
                Añadir
              </button>
            </div>
            <button nbButton (click)="guardarTodo()">Guardar todo</button>
          </form>

          <div class="row">
            <div class="col-md-12">
              <div class="form-group">
                <label class="label">Detalles de eventos</label>
                <ng2-smart-table
                  [settings]="settings"
                  [source]="sourceSmart"
                  (edit)="onEditRowSelect($event)"
                  (delete)="onDeleteRowSelect($event)"
                >
                </ng2-smart-table>
                <!-- <table
                  datatable
                  [dtOptions]="dtOptions"
                  class="table table-hover table table-striped table-dark row-border hover"
                >
                  <thead class="table-dark">
                    <tr>
                      <th scope="col">Observacion</th>
                      <th scope="col">Fecha</th>
                      <th scope="col">Hora</th>
                      <th scope="col">Participantes</th>
                      <th scope="col">Estado</th>
                      <th scope="col">Municipio</th>
                      <th scope="col">Acciones</th>
                    </tr>
                  </thead>

                  <tbody>
                    <tr *ngFor="let p of data">
                      <td>{{ p.observaciones }}</td>
                      <td>{{ p.fecha }}</td>
                      <td>{{ p.hora }}</td>
                      <td>{{ p.participantesProyectado }}</td>
                      <td>{{ p.estado }}</td>
                      <td>{{ p.municipioId.desMunicipio }}</td>
                      <td>
                        <button class="btn btn-danger">
                          <i class="nb-trash"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table> -->
              </div>
            </div>
          </div>

          <button nbButton nbStepperPrevious>Regresar</button>
          <!-- <button nbButton (click)="verDatos()">Guardar todo</button> -->
        </nb-card-body>
      </nb-step>
    </nb-stepper>
  </nb-card-body>
</nb-card>
